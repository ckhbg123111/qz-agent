# Deploy target: /etc/nginx/conf.d/ip177_to_aiqikang.conf
#
# Behavior (HTTP entry only):
# - Only requests from 192.168.1.177 are proxied to https://aiqikang.com
# - Other source IPs keep original app routing (http://127.0.0.1:8080)
#
# If your app upstream is different, change "local_app" below.

map $remote_addr $proxy_target {
    default               http://local_app;
    192.168.1.177         https://aiqikang.com;
}

map $remote_addr $proxy_host_header {
    default               $host;
    192.168.1.177         aiqikang.com;
}

upstream local_app {
    server 127.0.0.1:8080;
    keepalive 32;
}

server {
    listen 80;
    server_name _;

    location / {
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header Host $proxy_host_header;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_ssl_server_name on;
        proxy_pass $proxy_target$request_uri;
    }
}
